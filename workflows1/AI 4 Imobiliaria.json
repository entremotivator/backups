{
  "active": false,
  "connections": {
    "Chat": {
      "main": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Groq Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Agent Qualificacao",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agent Duvidas",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agent Agendamento",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Agent Informacoes Locacao",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Agents",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Worker Qualificacao": {
      "ai_tool": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agent Qualificacao": {
      "main": [
        [
          {
            "node": "Response 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Worker Duvidas": {
      "ai_tool": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Check Availability": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Check Unavailability": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "List Events": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Event Details": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Event": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update Event": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cancel Event": {
      "ai_tool": [
        [
          {
            "node": "Agent Agendamento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Worker Agendamento": {
      "ai_tool": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agent Duvidas": {
      "main": [
        [
          {
            "node": "Response 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agents": {
      "main": [
        [
          {
            "node": "Agent Qualificacao",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent Duvidas",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent Agendamento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent Informacoes Locacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent Informacoes Locacao": {
      "main": [
        [
          {
            "node": "Response 4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory Worker": {
      "ai_memory": [
        [
          {
            "node": "Agent Qualificacao",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Agent Duvidas",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Agent Agendamento",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Agent Informacoes Locacao",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Worker Info. Locação": {
      "ai_tool": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Agent Agendamento": {
      "main": [
        [
          {
            "node": "Response ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Reset Chat": {
      "ai_tool": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supervisor Imobiliario": {
      "main": [
        [
          {
            "node": "Response 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Supervisor Imobiliario",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-10-26T01:51:53.644Z",
  "id": "kfA6EYDvLSPaErXV",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "AI 4 Imobiliaria",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "6ebdd942-2e54-40f0-845f-3d1247a4c244",
      "name": "Chat",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        580,
        760
      ],
      "webhookId": "f7549e85-6464-4d02-80dd-a86edf7b0977"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5073973-4803-488e-8575-b51da11b5f0d",
              "name": "output",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "88e3beb6-480f-4f26-8e61-52ace2bf0414",
      "name": "Response 1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1140,
        760
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5073973-4803-488e-8575-b51da11b5f0d",
              "name": "output",
              "value": "=Please respond this to the user without modifications:\n\n{{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bd1c8ffb-ac85-4677-b82a-714734d397e0",
      "name": "Response 2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2400,
        540
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "agent_geral",
        "sessionTTL": 120,
        "contextWindowLength": 15
      },
      "id": "8565f2d7-9c10-4ad5-b9c1-b6e551baf1d0",
      "name": "Redis Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.3,
      "position": [
        820,
        940
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {},
      "id": "080fbdc0-33e4-42f5-95cb-1b4f8db03bb3",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        1420,
        760
      ]
    },
    {
      "parameters": {
        "model": "llama-3.2-90b-text-preview",
        "options": {
          "temperature": 0.5
        }
      },
      "id": "1f4dc29d-92f3-4511-8e0b-278cd088820b",
      "name": "Groq Chat Model2",
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        1580,
        1100
      ],
      "credentials": {
        "groqApi": {
          "id": "Qc9IFal2C1clPmRn",
          "name": "william"
        }
      }
    },
    {
      "parameters": {
        "name": "worker_qualificacao_tool",
        "description": "worker especializado em qualificação de leads, focado em entender as preferências dos clientes e oferecer as melhores opções de imóveis",
        "workflowId": {
          "__rl": true,
          "value": "kfA6EYDvLSPaErXV",
          "mode": "list",
          "cachedResultName": "Multi Agent"
        },
        "responsePropertyName": "output",
        "fields": {
          "values": [
            {
              "name": "sessionId",
              "stringValue": "={{ $json.sessionId }}"
            },
            {
              "name": "prompt",
              "stringValue": "={{ $json.chatInput }}"
            },
            {
              "name": "worker",
              "stringValue": "qualificacao"
            }
          ]
        }
      },
      "id": "ae2fc676-5b3e-45e9-97d4-0241980482da",
      "name": "Worker Qualificacao",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        960,
        1040
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "=<prompt_worker_qualificacao>\n\n<personalidade>\nSeu nome é Lucas. Você é um worker especializado em qualificação de leads, focado em entender as preferências dos clientes e oferecer as melhores opções de imóveis.\n</personalidade>\n\n<funcoes_principais>\n1. Identificar as necessidades do cliente com base em suas perguntas e preferências\n2. Realizar a qualificação do lead\n3. Oferecer sugestões de imóveis adequados\n</funcoes_principais>\n\n<regras_gerais>\n- Mantenha as perguntas objetivas e direcionadas para entender as preferências do cliente\n- Não ofereça mais do que 3 opções de imóveis por vez\n- Garanta que as recomendações estejam dentro dos parâmetros fornecidos pelo cliente\n- Caso as informações sejam insuficientes, peça mais detalhes ao supervisor\n</regras_gerais>\n\n<exemplo_de_interacao>\n- Supervisor: \"O cliente está buscando um imóvel com 2 quartos no centro da cidade. Quais opções podemos oferecer?\"\n- Lucas (Worker de Qualificação): \"Aqui estão algumas opções:\n   1. Apartamento no Centro: 2 quartos, R$ 1500/mês, próximo ao shopping\n   2. Casa no Jardim: 2 quartos, R$ 1800/mês, com garagem\n   3. Sobrado no Bairro: 2 quartos, R$ 1600/mês, com área de lazer\"\n\n</prompt_worker_qualificacao>\n"
        }
      },
      "id": "c2f4c3f6-8140-4c6d-82a1-ef9e07b2927d",
      "name": "Agent Qualificacao",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        2040,
        540
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5073973-4803-488e-8575-b51da11b5f0d",
              "name": "output",
              "value": "=Please respond this to the user without modifications:\n\n{{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "dce35177-fd95-4fad-9bd2-9be2aac08fb7",
      "name": "Response 3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2400,
        780
      ]
    },
    {
      "parameters": {
        "name": "worker_duvidas_tool",
        "description": "worker especializado em esclarecer dúvidas sobre o processo de locação de imóveis na imobiliária Lorena",
        "workflowId": {
          "__rl": true,
          "value": "kfA6EYDvLSPaErXV",
          "mode": "list",
          "cachedResultName": "Multi Agent"
        },
        "responsePropertyName": "output",
        "fields": {
          "values": [
            {
              "name": "sessionId",
              "stringValue": "={{ $json.sessionId }}"
            },
            {
              "name": "prompt",
              "stringValue": "={{ $json.chatInput }}"
            },
            {
              "name": "worker",
              "stringValue": "duvidas"
            }
          ]
        }
      },
      "id": "647b0143-2ae6-4df6-ad07-c5f98fc60284",
      "name": "Worker Duvidas",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        1060,
        1020
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5073973-4803-488e-8575-b51da11b5f0d",
              "name": "output",
              "value": "=Please respond this to the user without modifications:\n\n{{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "52eca990-ebd2-43a6-88fa-6cd79c8a433f",
      "name": "Response ",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2400,
        1020
      ]
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to return a list of events. Ask the user for the date of the existing reservation. Use the user's date to search for the existing reservation. If the user's date does not match the results or no results are returned, the existing reservation was not found.\n\nIf the tool returns an empty response, it means something went wrong. It does not mean there is no downtime.",
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "limit": 30,
        "options": {
          "timeMin": "={{ $fromAI('date_after', 'somente se for informado') }}",
          "timeMax": "={{ $fromAI('date_before', 'somente se for informado') }}",
          "fields": "items(id,status,htmlLink,created,summary,description,creator,organizer,start(dateTime),end(dateTime),hangoutLink)"
        }
      },
      "id": "b3500528-bf63-43fc-affd-82efd0cfccf9",
      "name": "List Events",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2120,
        1280
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to get the calendar availability for a particular period on the calendar. The tool may refer to availability as \"Free\" or \"Busy\".\n\nIf the tool returns an empty response, it means that something went wrong. It does not mean that there is no availability.",
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "timeMin": "={{ $fromAI('startTime', 'format 2024-10-27T23:48:34', 'string') }}",
        "timeMax": "={{ $fromAI('endTime', 'format 2024-10-27T23:48:34', 'string') }}",
        "options": {
          "outputFormat": "availability"
        }
      },
      "id": "85d824b5-4846-4f15-9ff6-01403dc739b0",
      "name": "Check Availability",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        1920,
        1320
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to get the calendar unavailability for a particular period on the calendar. The tool may refer to unavailability as \"Busy\".\n\nIf the tool returns an empty response, it means that something went wrong. It does not mean that there is no unavailability.",
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "timeMin": "={{ $fromAI('startTime', 'format 2024-10-27T23:48:34', 'string') }}",
        "timeMax": "={{ $fromAI('endTime', 'format 2024-10-27T23:48:34', 'string') }}",
        "options": {
          "outputFormat": "bookedSlots"
        }
      },
      "id": "11b118db-2fd3-4cec-ab0f-9715b3f33fac",
      "name": "Check Unavailability",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2020,
        1280
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to return details of an event using the listed event ID. If you don't know the ID at this time, please note that you need to list it first before you can return details of a listed event.\n\nIf the tool returns an empty response, it means something went wrong. It doesn't mean there's no downtime.",
        "operation": "get",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "eventId": "{{ $fromAI('id') }}",
        "options": {
          "maxAttendees": 10
        }
      },
      "id": "fc45f282-d7c2-4d0c-a6ca-974fc6b014c5",
      "name": "Get Event Details",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2220,
        1260
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to create an event. Always ask for confirmation of the event data to be created before finalizing its creation.\n\nIf the tool returns an empty response, it means that something went wrong. This does not mean that there is no downtime.",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "start": "={{ $fromAI('date_init', 'sempre a partir do horário atual') }}",
        "end": "={{ $fromAI('date_end') }}",
        "additionalFields": {
          "attendees": [],
          "description": "={{ $fromAI('description') }}",
          "summary": "={{ $fromAI('summary') }}"
        }
      },
      "id": "10b1716e-7495-4d63-84ea-db5eac2c2c59",
      "name": "Create Event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2320,
        1280
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Call this tool to update an event. Always ask for confirmation of the event data to be updated before finalizing your change.\n\nIf the tool returns an empty response, it means something went wrong. This does not mean there is no downtime.",
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "eventId": "={{ $fromAI('id') }}",
        "updateFields": {
          "description": "={{ $fromAI('description') }}",
          "end": "={{ $fromAI('date_end') }}",
          "start": "={{ $fromAI('date_init', 'sempre a partir do horário atual') }}",
          "summary": "={{ $fromAI('summary') }}"
        }
      },
      "id": "975a1024-2192-4a8f-af0d-f7f7df412312",
      "name": "Update Event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2420,
        1300
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "williamkillerca@gmail.com",
          "mode": "list",
          "cachedResultName": "williamkillerca@hotmail.com"
        },
        "eventId": "={{ $fromAI('id') }}",
        "options": {}
      },
      "id": "c8bdbc0f-3f9b-41cc-bc7d-709d846aed49",
      "name": "Cancel Event",
      "type": "n8n-nodes-base.googleCalendarTool",
      "typeVersion": 1.1,
      "position": [
        2520,
        1340
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "mQv2XCcAIiyPKV2D",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "name": "worker_agendamento_tool",
        "description": "worker especializada em agendamento de visitas para imóveis da imobiliária Lorena",
        "workflowId": {
          "__rl": true,
          "value": "kfA6EYDvLSPaErXV",
          "mode": "list",
          "cachedResultName": "Multi Agent"
        },
        "responsePropertyName": "output",
        "fields": {
          "values": [
            {
              "name": "sessionId",
              "stringValue": "={{ $json.sessionId }}"
            },
            {
              "name": "prompt",
              "stringValue": "={{ $json.chatInput }}"
            },
            {
              "name": "worker",
              "stringValue": "agendamento"
            }
          ]
        }
      },
      "id": "25718f5b-30be-4f2b-acc8-4074369b2943",
      "name": "Worker Agendamento",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        1160,
        1040
      ]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini-2024-07-18",
        "options": {
          "maxTokens": 2048,
          "temperature": 0.7,
          "maxRetries": 2,
          "topP": 0.9
        }
      },
      "id": "5463e16e-7ee4-4c9b-9592-85447eeac7b5",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        700,
        940
      ],
      "credentials": {
        "openAiApi": {
          "id": "dRR3EqW0FEAbSHgt",
          "name": "william"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5073973-4803-488e-8575-b51da11b5f0d",
              "name": "output",
              "value": "=Please respond this to the user without modifications:\n\n{{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "7644b244-2c60-4143-ba7a-a027df1f732d",
      "name": "Response 4",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2400,
        1540
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "=<prompt_worker_duvidas>\n\n<personalidade>\nSeu nome é Rafael. Você é uma worker especializado em esclarecer dúvidas sobre o processo de locação de imóveis na imobiliária Lorena.\n</personalidade>\n\n<funcoes_principais>\n1. Responder perguntas sobre o processo de locação, documentos necessários, e prazos\n2. Fornecer informações detalhadas sobre garantias (fiador, seguro-fiança, etc.)\n3. Retornar ao supervisor com a resposta pronta para o cliente\n</funcoes_principais>\n\n<regras_gerais>\n- Use linguagem simples e objetiva\n- Garanta que as informações sejam baseadas na base de conhecimento\n- Caso a pergunta seja muito complexa, peça ao supervisor para encaminhar a um atendente humano\n</regras_gerais>\n\n<exemplo_de_interacao>\n- Supervisor: \"O cliente gostaria de saber mais sobre os tipos de garantia aceitos para alugar o imóvel.\"\n- Rafael (Worker de Dúvidas): \"Para alugar um imóvel, você pode usar um fiador, contratar seguro-fiança ou fazer um depósito caução. Alguma dessas opções atende suas necessidades?\"\n\n</prompt_worker_duvidas>\n"
        }
      },
      "id": "20392dc0-eed4-4ec6-b23c-4ef166edb409",
      "name": "Agent Duvidas",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        2040,
        780
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d7fc89a3-b33f-4494-9298-ed4fb1dc406d",
                    "leftValue": "={{ $json.worker }}",
                    "rightValue": "qualificacao",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "qualificação"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cefcb9fa-b2da-42e4-94b2-2b48f8babeb1",
                    "leftValue": "={{ $json.worker }}",
                    "rightValue": "duvidas",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "dúvidas"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5debb65f-958f-4d7c-b0bc-c210727fcf9f",
                    "leftValue": "={{ $json.worker }}",
                    "rightValue": "agendamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agendamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e26be880-426b-4898-a288-2a17f5ca2de3",
                    "leftValue": "={{ $json.worker }}",
                    "rightValue": "informacoes_locacao",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "informações locação"
            }
          ]
        },
        "options": {}
      },
      "id": "b1ad6db6-bd50-4a78-9203-4804eb1ba950",
      "name": "Agents",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1580,
        760
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "=<prompt_worker_informacoes_locacao>\n\n<personalidade>\nSeu nome é Felipe. Você é uma worker especializado em fornecer informações detalhadas sobre o processo de locação.\n</personalidade>\n\n<funcoes_principais>\n1. Explicar o processo de locação\n2. Fornecer detalhes sobre documentos necessários, garantias aceitas e prazos\n3. Responder a dúvidas específicas sobre direitos e deveres do locatário\n</funcoes_principais>\n\n<regras_gerais>\n- Use linguagem clara e objetiva\n- Certifique-se de que as informações estejam de acordo com a política da imobiliária\n</regras_gerais>\n\n<exemplo_de_interacao>\n- Supervisor: \"O cliente quer saber mais sobre os documentos necessários para alugar um imóvel.\"\n- Felipe: \"Para alugar um imóvel, você precisará de documentos como RG, CPF, comprovante de renda e comprovante de residência. Também aceitamos fiador, seguro-fiança ou depósito caução como garantias.\"\n</exemplo_de_interacao>\n\n</prompt_worker_informacoes_locacao>\n"
        }
      },
      "id": "1ef4d982-6709-4d97-a941-67ca0fc7eec4",
      "name": "Agent Informacoes Locacao",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        2040,
        1540
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=worker_{{ $json.worker }}",
        "sessionTTL": 120,
        "contextWindowLength": 15
      },
      "id": "f46dc690-9d08-453d-8a01-70657052b642",
      "name": "Redis Chat Memory Worker",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.3,
      "position": [
        1680,
        1100
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      }
    },
    {
      "parameters": {
        "name": "worker_informacoes_locacao_tool",
        "description": "worker especializado em fornecer informações detalhadas sobre o processo de locação",
        "workflowId": {
          "__rl": true,
          "value": "kfA6EYDvLSPaErXV",
          "mode": "list",
          "cachedResultName": "Multi Agent"
        },
        "responsePropertyName": "output",
        "fields": {
          "values": [
            {
              "name": "sessionId",
              "stringValue": "={{ $json.sessionId }}"
            },
            {
              "name": "prompt",
              "stringValue": "={{ $json.chatInput }}"
            },
            {
              "name": "worker",
              "stringValue": "informacoes_locacao"
            }
          ]
        }
      },
      "id": "f11d558a-4b1c-47b4-bc90-fbbb712293eb",
      "name": "Worker Info. Locação",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        1260,
        1020
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "=<prompt_worker_agendamento>\n\n<personalidade>\nSeu nome é Ana. Você é uma worker especializada em agendamento de visitas para imóveis da imobiliária Lorena.\n</personalidade>\n\n<funcoes_principais>\n1. Verificar a disponibilidade de horários para visitas\n2. Confirmar a data e horário com o cliente e proprietário\n3. Notificar o supervisor sobre o agendamento realizado\n</funcoes_principais>\n\n<regras_gerais>\n- Verifique a disponibilidade do imóvel na base de dados antes de sugerir horários\n- Garanta que os detalhes do agendamento estejam corretos antes de confirmar\n- Se não houver horários disponíveis, peça ao supervisor para sugerir alternativas\n</regras_gerais>\n\n<informacoes_para_guia>\nData e Hora: {{ $now.toISO() }}\n</informacoes_para_guia>\n\n<exemplo_de_interacao>\n- Supervisor: \"O cliente gostaria de agendar uma visita para o apartamento no Centro.\"\n- Ana (Worker de Agendamento): \"A visita pode ser realizada amanhã às 14h. Deseja confirmar esse horário?\"\n\n</prompt_worker_agendamento>\n"
        }
      },
      "id": "ed7fb8e8-87ff-4bc5-90d8-9f107de02615",
      "name": "Agent Agendamento",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        2040,
        1020
      ]
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "reset redis chat memory",
        "operation": "delete",
        "key": "agent_geral"
      },
      "id": "be84aab7-2c3b-47a1-aa01-cdbac70d4342",
      "name": "Redis Reset Chat",
      "type": "n8n-nodes-base.redisTool",
      "typeVersion": 1,
      "position": [
        840,
        1120
      ],
      "credentials": {
        "redis": {
          "id": "ePjUcKkuSrLqo1Tt",
          "name": "vps"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Chat').item.json.chatInput }}",
        "options": {
          "systemMessage": "=<prompt_supervisor_imobiliario>\n\n<personalidade>\nSeu nome é Larissa. Você é a supervisora das assistentes virtuais da imobiliária Lorena. Seu papel é coordenar as interações entre os workers, garantir que os clientes recebam informações precisas e resolver quaisquer questões que os workers não possam tratar.\n</personalidade>\n\n<funcoes_principais>\n1. Monitorar as interações entre os workers\n2. Garantir que os clientes sejam atendidos de forma eficiente e profissional\n3. Intervir em casos de complexidade ou dúvidas que os workers não consigam resolver\n4. Coletar feedback dos clientes sobre o atendimento\n5. Treinar e atualizar os workers sobre novos procedimentos e informações\n</funcoes_principais>\n\n<fluxo_atendimento>\n1. Receber a solicitação do cliente\n2. Se a solicitação for complexa ou abranger múltiplas áreas, esclarecer com o cliente se ele pode dividir a pergunta em partes mais específicas.\n3. Direcionar a solicitação para o worker apropriado (qualificação de leads, agendamento de visitas, esclarecimento de dúvidas, envio de links e fotos, ou informações sobre locação)\n4. Monitorar a interação e garantir que o cliente receba as informações necessárias\n5. Intervir quando um worker não puder resolver uma questão ou quando o cliente solicitar um atendimento mais detalhado\n6. Finalizar a interação com um resumo dos próximos passos para o cliente\n</fluxo_atendimento>\n\n<regras_gerais>\n- Mantenha uma comunicação clara e objetiva\n- Certifique-se de que todos os workers estejam alinhados com as políticas da imobiliária\n- Priorize as necessidades do cliente em todas as interações\n- Incentive os clientes a dividirem suas perguntas complexas em partes mais simples para evitar confusões\n- Registre e reporte qualquer problema ou feedback relevante\n</regras_gerais>\n\n<exemplo_de_interacao>\n- Cliente: \"Quero saber mais sobre os documentos necessários para alugar um imóvel.\"\n- Larissa: \"Deixe-me transferir você para o Felipe, nosso especialista em informações sobre locação.\"\n\n- Cliente: \"Gostaria de ver fotos do imóvel no Centro.\"\n- Larissa: \"Vou pedir à Marina, nossa especialista em envio de links e fotos, para enviar isso para você.\"\n\n</exemplo_de_interacao>\n\n</prompt_supervisor_imobiliario>\n"
        }
      },
      "id": "670512f7-48ff-4bef-9d95-e9d8a629d80b",
      "name": "Supervisor Imobiliario",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        780,
        760
      ],
      "notes": "<prompt_supervisor_imobiliario>\n\n<personalidade>\nSeu nome é Larissa. Você é a supervisora das assistentes virtuais da imobiliária Lorena. Seu papel é coordenar as interações entre os workers, garantir que os clientes recebam informações precisas e resolver quaisquer questões que os workers não possam tratar.\n</personalidade>\n\n<funcoes_principais>\n1. Monitorar as interações entre os workers\n2. Garantir que os clientes sejam atendidos de forma eficiente e profissional\n3. Intervir em casos de complexidade ou dúvidas que os workers não consigam resolver\n4. Coletar feedback dos clientes sobre o atendimento\n5. Treinar e atualizar os workers sobre novos procedimentos e informações\n</funcoes_principais>\n\n<fluxo_atendimento>\n1. Receber a solicitação do cliente\n2. Se a solicitação for complexa ou abranger múltiplas áreas, esclarecer com o cliente se ele pode dividir a pergunta em partes mais específicas.\n3. Direcionar a solicitação para o worker apropriado (qualificação de leads, agendamento de visitas, esclarecimento de dúvidas, envio de links e fotos, ou informações sobre locação)\n4. Monitorar a interação e garantir que o cliente receba as informações necessárias\n5. Intervir quando um worker não puder resolver uma questão ou quando o cliente solicitar um atendimento mais detalhado\n6. Finalizar a interação com um resumo dos próximos passos para o cliente\n</fluxo_atendimento>\n\n<regras_gerais>\n- Mantenha uma comunicação clara e objetiva\n- Certifique-se de que todos os workers estejam alinhados com as políticas da imobiliária\n- Priorize as necessidades do cliente em todas as interações\n- Incentive os clientes a dividirem suas perguntas complexas em partes mais simples para evitar confusões\n- Registre e reporte qualquer problema ou feedback relevante\n</regras_gerais>\n\n<exemplo_de_interacao>\n- Cliente: \"Quero saber mais sobre os documentos necessários para alugar um imóvel.\"\n- Larissa: \"Deixe-me transferir você para o Felipe, nosso especialista em informações sobre locação.\"\n\n- Cliente: \"Gostaria de ver fotos do imóvel no Centro.\"\n- Larissa: \"Vou pedir à Marina, nossa especialista em envio de links e fotos, para enviar isso para você.\"\n\n</exemplo_de_interacao>\n\n</prompt_supervisor_imobiliario>\n"
    }
  ],
  "pinData": {
    "Execute Workflow Trigger": [
      {
        "json": {
          "query": "casa em Lorena",
          "sessionId": "test-fd3765db-9980-4841-8ea8-be5a8563836b",
          "prompt": "como faço para alugar uma casa",
          "worker": "duvidas"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-10-08T13:33:46.636Z",
      "updatedAt": "2024-10-08T13:33:46.636Z",
      "id": "aSNW5tPyOIOEr9rS",
      "name": "Agent"
    },
    {
      "createdAt": "2024-09-27T17:42:17.034Z",
      "updatedAt": "2024-09-27T17:42:17.034Z",
      "id": "TsfCA8eZuTObjOfy",
      "name": "Backup"
    },
    {
      "createdAt": "2024-09-27T14:34:01.317Z",
      "updatedAt": "2024-09-27T14:34:01.317Z",
      "id": "ZoTSEGR97fzorfDz",
      "name": "AI"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2024-10-29T04:38:32.474Z",
  "versionId": "495dd806-3c27-4faf-8595-9880859ac85f"
}